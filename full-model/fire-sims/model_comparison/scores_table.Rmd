---
title: "scores_tables"
output: 
  pdf_document: 
    keep_tex: yes
date: "2023-06-26"
---

```{r eval=FALSE, message=FALSE, include=FALSE}
library(kableExtra)
library(tidyr)
library(dplyr)
library(stringr)
library(tibble)

# joint model tables
twcrps_full <- readRDS("~/Desktop/research/egpd-fires/full-model/fire-sims/model_comparison/joint_twcrps.RDS")
test_twcrps_ranked <- twcrps_full %>% filter(train == FALSE) %>% 
  group_by(model) %>% 
  summarize(mean_twcrps = mean(twcrps, na.rm = TRUE)) %>% arrange(mean_twcrps)
top_mod_test_twcrps <- as.character(test_twcrps_ranked$model[1])
test_twcrps_comp <- twcrps_full %>% filter(train == FALSE) %>% 
  dplyr::select(c(draw, model, twcrps)) %>% 
  pivot_wider(names_from = model, values_from = twcrps, values_fill = NA) %>% 
  mutate(across(.cols = -draw, ~ .x - get(top_mod_test_twcrps))) %>% 
  pivot_longer(cols = -draw, names_to = "model") %>%
  group_by(model) %>%
  summarize(mean_diff = mean(value[is.finite(value)]), sd_diff = sd(value[is.finite(value)])) %>% arrange(mean_diff)
test_twcrps_comp_all_iter <- test_twcrps_comp %>% rename(twcrps_mean_diff = mean_diff, twcrps_sd_diff = sd_diff)

test_twcrps_ranked <- twcrps_full %>% filter(train == FALSE, grepl("1000iter", model)) %>% 
  group_by(model) %>% 
  summarize(mean_twcrps = mean(twcrps, na.rm = TRUE)) %>% arrange(mean_twcrps)
top_mod_test_twcrps <- as.character(test_twcrps_ranked$model[1])
test_twcrps_comp <- twcrps_full %>% filter(train == FALSE, grepl("1000iter", model)) %>% 
  dplyr::select(c(draw, model, twcrps)) %>% 
  pivot_wider(names_from = model, values_from = twcrps, values_fill = NA) %>% 
  mutate(across(.cols = -draw, ~ .x - get(top_mod_test_twcrps))) %>% 
  pivot_longer(cols = -draw, names_to = "model") %>%
  group_by(model) %>%
  summarize(mean_diff = mean(value[is.finite(value)]), sd_diff = sd(value[is.finite(value)])) %>% arrange(mean_diff)
test_twcrps_comp_1000iter <- test_twcrps_comp %>% rename(twcrps_mean_diff = mean_diff, twcrps_sd_diff = sd_diff)

total_ll <- readRDS("~/Desktop/research/egpd-fires/full-model/fire-sims/model_comparison/joint_loglik.RDS")$total_ll
test_ll_total_ranked <- total_ll %>% filter(train == FALSE, grepl("1000iter", model)) %>% 
  group_by(draw, model, train) %>%
  summarize(loglik_total = sum(loglik)) %>% ungroup() %>%
  group_by(model) %>% 
  summarize(med_test_ll = median(loglik_total)) %>% arrange(-med_test_ll)
top_mod_total_test <- as.character(test_ll_total_ranked$model[1])
test_ll_total_comp <- total_ll %>% filter(train == FALSE, grepl("1000iter", model)) %>% 
  group_by(draw, model, train) %>%
  summarize(loglik_total = sum(loglik)) %>% ungroup() %>%
  dplyr::select(c(draw, model, loglik_total)) %>% 
  pivot_wider(names_from = model, values_from = loglik_total, values_fill = NA) %>% 
  mutate(across(.cols = -draw, ~ .x - get(top_mod_total_test))) %>% 
  pivot_longer(cols = -draw, names_to = "model") %>%
  group_by(model) %>%
  summarize(med_diff = median(value[is.finite(value)]), sd_diff = sd(value[is.finite(value)])) %>% arrange(-med_diff)
test_ll_total_comp_1000iter <- test_ll_total_comp %>% rename(loglik_mean_diff = med_diff, loglik_sd_diff = sd_diff)

joint_scores <- test_twcrps_comp_1000iter %>% left_join(test_ll_total_comp_1000iter)
joint_scores <- joint_scores %>% 
  mutate(gamma = case_when(grepl("gamma-ri", model) ~ 'ri',
                           TRUE ~ 'cst'))

joint_scores %>% mutate_if(is.numeric, round, 3) %>% dplyr::select(-model) %>% relocate('gamma', .before = 'twcrps_mean_diff') %>%
  rename("$\\gamma$" = gamma, "Mean_tw" = twcrps_mean_diff, "SD_tw" = twcrps_sd_diff, "Mean_ll" = loglik_mean_diff, "SD_ll" = loglik_sd_diff) %>%
  kable(., format='latex', booktabs=T, escape = F)
  
  # %>% add_header_above(c(" "=1, "twCRPS" = 2, "Log-likelihood" = 2)) %>%
  # # collapse_rows(columns = 1, latex_hline = "major", valign = "middle")

```

```{r echo=FALSE}
library(kableExtra)
library(tidyr)
library(dplyr)
library(stringr)
library(tibble)

burn_scores <- readRDS("~/Desktop/research/egpd-fires/full-model/fire-sims/model_comparison/burn_scores.RDS")
twcrps_full <- burn_scores$twcrps
test_twcrps_ranked <- twcrps_full %>% filter(train == FALSE) %>% 
  group_by(model) %>% 
  summarize(mean_twcrps = mean(twcrps, na.rm = TRUE)) %>% arrange(mean_twcrps)
top_mod_test_twcrps <- as.character(test_twcrps_ranked$model[1])
test_twcrps_comp <- twcrps_full %>% filter(train == FALSE) %>% 
  dplyr::select(c(draw, model, twcrps)) %>% 
  pivot_wider(names_from = model, values_from = twcrps, values_fill = NA) %>% 
  mutate(across(.cols = -draw, ~ .x - get(top_mod_test_twcrps))) %>% 
  pivot_longer(cols = -draw, names_to = "model") %>%
  group_by(model) %>%
  summarize(mean_diff = mean(value[is.finite(value)]), sd_diff = sd(value[is.finite(value)])) %>% arrange(mean_diff)
test_twcrps_comp <- test_twcrps_comp

test_twcrps_comp <- test_twcrps_comp %>% 
  mutate(kappa = case_when(grepl('sigma', model) ~ 'reg',
                           grepl('g1_xi-ri', model) ~ 'reg',
                               TRUE ~ 'ri'),
         sigma = case_when(grepl('kappa-ri', model) ~ 'reg',
                           grepl('g1_xi-ri', model) ~ 'reg',
                           grepl('sigma-ri', model) ~ 'ri',
                           grepl('sigma-cst', model) ~ 'cst'),
         xi = case_when(grepl('xi-ri', model) ~ 'ri',
                        TRUE ~ NA)) %>%
  filter(!grepl("nu", model)) %>%
  separate_wider_delim(cols = model, delim = "_", names = "model", too_many = "drop") %>%
  rename(mdiff = mean_diff, sdiff = sd_diff)

test_twcrps_comp %>% arrange(model, mdiff) %>% 
  relocate(c('kappa', 'sigma', 'xi'), .before = 'mdiff') %>% mutate_if(is.numeric, round, 3) %>% 
    mutate(kappa = case_when(kappa == 'reg' & model != 'lognorm' ~ "$\\checkmark$", 
                             kappa == 'reg' & model == 'lognorm' ~ "($\\checkmark$)", 
                             kappa == 'ri' ~ "--"),
           sigma = case_when(sigma == 'reg' ~ "$\\checkmark$",
                             sigma == 'ri' ~ "--",
                             sigma == 'cst' ~ "*"),
           xi = case_when(xi == 'reg' ~ "$\\checkmark$",
                          xi == 'ri' ~ "--"),
           model = case_when(model == 'g1' ~ "$G_1$",
                             model == 'g2' ~ "$G_2$",
                             model == 'lognorm' ~ "Lognormal")) %>% 
  rename("$\\kappa$($\\mu$)" = kappa, "$\\sigma$" = sigma, "$\\xi$" = xi, 
         "Mean" = mdiff, "SD" = sdiff, "Model" = model) %>% 
  kable(., format='latex', align = 'c', booktabs=T, escape = F) %>% add_header_above(c(" "=1, "Regression" = 3, "Difference" = 2)) %>%
  collapse_rows(columns = 1, latex_hline = "major", valign = "middle")
```


```{r eval=FALSE, message=FALSE, include=FALSE}
library(kableExtra)
library(tidyr)
library(dplyr)
library(stringr)
library(tibble)
load("~/Desktop/research/egpd-fires/full-model/fire-sims/model_comparison/burns_comp_tables.RData")
test_ll_sort <- ll_full %>% filter(train == FALSE, dataset == "og") %>% 
  group_by(fullname, model, dataset, params) %>% 
  summarize(med_test_ll = median(loglik)) %>% arrange(-med_test_ll)
top_mod_test <- as.character(test_ll_sort$fullname[2])

ll_comp_test_full <- ll_full %>% filter(train == FALSE, dataset == "og") %>% 
  select(c(draw, fullname, loglik)) %>% 
  pivot_wider(names_from = fullname, values_from = loglik, values_fill = NA) %>% 
  mutate(across(.cols = -draw, ~ .x - get(top_mod_test))) %>% 
  pivot_longer(cols = -draw, names_to = "model") %>%
  group_by(model) %>%
  summarize(mean_diff = mean(value[is.finite(value)]), sd_diff = sd(value[is.finite(value)])) %>% arrange(-mean_diff)

table_ll_burns <- ll_comp_test_full %>% 
  mutate(kappa = case_when(model == 'g1_og_kappa-ri_sigma-reg' ~ 'ri',
                               TRUE ~ 'reg'),
         sigma = case_when(model == 'g1_og_sigma-ri' ~ 'ri',
                               model == 'lognorm_og_sigma-cst' ~ 'cst',
                               model == 'lognorm_og_sigma-ri' ~ 'ri',
                               model == 'g2_og_sigma-ri' ~ 'ri',
                               TRUE ~ 'reg'),
         xi = case_when(model == 'g1_og_all-reg_sigma-reg' ~ 'reg',
                            TRUE ~ 'ri')) %>%
  separate_wider_delim(cols = model, delim = "_", names = "model", too_many = "drop") %>%
  rename(mdiff = mean_diff, sdiff = sd_diff)

table_ll_burns %>% arrange(model) %>% 
  relocate(c('kappa', 'sigma', 'xi'), .before = 'mdiff') %>% mutate_if(is.numeric, round, 3) %>% 
    mutate(kappa = case_when(kappa == 'reg' & model != 'lognorm' ~ "$\\checkmark$", 
                             kappa == 'reg' & model == 'lognorm' ~ "($\\checkmark$)", 
                             kappa == 'ri' ~ "--"),
           sigma = case_when(sigma == 'reg' ~ "$\\checkmark$",
                             sigma == 'ri' ~ "--",
                             sigma == 'cst' ~ "*"),
           xi = case_when(xi == 'reg' ~ "$\\checkmark$",
                          xi == 'ri' ~ "--"),
           model = case_when(model == 'g1' ~ "$G_1$",
                             model == 'g2' ~ "$G_2$",
                             model == 'lognorm' ~ "Lognormal")) %>% 
  rename("$\\kappa$($\\mu$)" = kappa, "$\\sigma$" = sigma, "$\\xi$" = xi, 
         "Mean" = mdiff, "SD" = sdiff, "Model" = model) %>% 
  kable(., format='latex', align = 'c', booktabs=T, escape = F) %>% add_header_above(c(" "=1, "Regression" = 3, "Difference" = 2)) %>%
  collapse_rows(columns = 1, latex_hline = "major", valign = "middle")
```

```{r eval=FALSE, message=FALSE, include=FALSE}
library(kableExtra)
library(tidyr)
library(dplyr)
library(stringr)
library(tibble)
ll_comp_test_full <- readRDS("full-model/fire-sims/model_comparison/count_scores.RDS")

table_ll_burns <- ll_comp_test_full %>% 
  mutate(lambda = 'reg',
         pi = case_when(model == 'zinb_er_pi-ri' ~ 'ri',
                        model == 'zinb_pi-ri' ~ 'ri',
                        model == 'zip_pi-ri' ~ 'ri',
                               TRUE ~ 'reg'),
         delta = case_when(model == 'zinb_er_pi-ri' ~ 'ri',
                           model == 'zinb_er_all-reg' ~ 'ri',
                           model == 'zinb_all-reg' ~ 'cst',
                           model == 'zinb_pi-ri' ~ 'cst',
                           TRUE ~ 'NA')) %>%
  separate_wider_delim(cols = model, delim = "_", names = c("model", "submodel"), too_many = "drop") %>%
  rename(mdiff = mean_diff, sdiff = sd_diff)

table_ll_burns %>% arrange(model) %>% 
  relocate(c('lambda', 'pi', 'delta'), .before = 'mdiff') %>% mutate_if(is.numeric, round, 3) %>% 
    mutate(lambda = case_when(lambda == 'reg' ~ "$\\checkmark$", 
                             TRUE ~ NA ),
           pi = case_when(pi == 'reg' ~ "$\\checkmark$",
                             pi == 'ri' ~ "--",
                             pi == 'cst' ~ "*"),
           delta = case_when(delta == 'reg' ~ "$\\checkmark$",
                             delta == 'ri' ~ "--",
                             delta == 'cst' ~ "*",
                             delta == 'NA' ~ ''),
           model = case_when(model == 'zinb' ~ "ZI-Negative Binomial",
                             model == 'zip' ~ "ZI-Poisson")) %>% select(-submodel) %>% 
  rename("$\\lambda$" = lambda, "$\\pi$" = pi, "$\\delta$" = delta, 
         "Mean" = mdiff, "SD" = sdiff, "Model" = model) %>% 
  kable(., format='latex', align = 'c', booktabs=T, escape = F) %>% add_header_above(c(" "=1, "Regression" = 3, "Difference" = 2)) %>%
  collapse_rows(columns = 1, latex_hline = "major", valign = "middle")
```

